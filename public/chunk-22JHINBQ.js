import{a as g}from"./chunk-7NYZPO2S.js";import{d as f}from"./chunk-TRWNYS6K.js";import{n as d,p as l,q as k}from"./chunk-23D7R4XH.js";import{B as S,P as a,S as v,Y as n,a as m,b as c,p,t as h}from"./chunk-27BBFG4U.js";var r=l.BASE_URL,j=(()=>{class i{http=n(d);router=n(f);localStorageSvc=n(k);user;googleEmail="";get token(){return this.localStorageSvc.getItem("token")||""}get role(){return this.user.role||"USER_ROLE"}get uid(){return this.user.uid||""}get headers(){return{headers:{"x-token":this.token}}}saveLocalStorage(e,t){this.localStorageSvc.setItem("token",e),this.localStorageSvc.setItem("menu",JSON.stringify(t))}logout(){this.user.google===!0?(this.googleEmail=this.user.email,google.accounts.id.revoke(this.googleEmail,()=>{this.localStorageSvc.removeItem("token"),this.localStorageSvc.removeItem("menu"),this.router.navigateByUrl("/login")})):(this.localStorageSvc.removeItem("token"),this.localStorageSvc.removeItem("menu"),this.router.navigateByUrl("/login"))}validateToken(){return this.http.get(`${r}/login/renew`,this.headers).pipe(h(e=>{let{name:t,email:s,img:u="",google:o,role:$,uid:I}=e.user;return this.user=new g(t,s,"",u,o,$,I),this.saveLocalStorage(e.token,e.menu),!0}),S(()=>p(!1)))}getUsers(){return this.http.get(`${l.API_ENDPOINT}${l.METHODS.GET_ALL_USERS}`)}createUser(e){return this.http.post(`${r}/users`,e).pipe(a(t=>{this.saveLocalStorage(t.token,t.menu)}))}updateProfile(e){return e=c(m({},e),{role:this.user.role}),this.http.put(`${r}/users/${this.uid}`,e,this.headers)}login(e){return this.http.post(`${r}/login`,e).pipe(a(t=>{this.saveLocalStorage(t.token,t.menu)}))}loginGoogle(e){return this.http.post(`${r}/login/google`,{token:e}).pipe(a(t=>{this.saveLocalStorage(t.token,t.menu)}))}loadUsers(e=0){let t=`${r}/users?from=${e}`;return this.http.get(t,this.headers).pipe(h(s=>{let u=s.users.map(o=>new g(o.name,o.email,"",o.img,o.google,o.role,o.uid));return{total:s.total,users:u}}))}deleteUser(e){let t=`${r}/users/${e.uid}`;return this.http.delete(t,this.headers)}saveUser(e){let t=`${r}/users/${e.uid}`;return this.http.put(t,e,this.headers)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=v({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();export{j as a};
